# API测试工具使用指南

> **版本**: v1.0  
> **最后更新**: 2025-10-16  
> **适用对象**: 前端开发者、测试人员

---

## 📚 简介

本测试工具提供了青羽平台所有主要API接口的可视化测试功能，帮助开发者快速验证API功能和调试问题。

### 功能特性

- ✅ 用户认证API测试（注册、登录、个人信息管理）
- ✅ 书城系统API测试（首页、书籍列表、搜索）
- ✅ 阅读器API测试（章节内容、阅读进度、设置）
- ✅ 注记功能API测试（书签、高亮、笔记）
- ✅ 评分系统API测试（评分CRUD操作）
- ✅ 实时响应预览
- ✅ Token自动管理

---

## 🚀 快速开始

### 访问测试工具

1. **通过导航菜单访问**
   - 启动前端开发服务器：`npm run dev`
   - 在浏览器中打开应用
   - 点击顶部导航栏的 "API测试" 菜单项

2. **直接访问URL**
   ```
   http://localhost:5173/api-test
   ```

### 前置条件

1. **后端服务运行中**
   ```bash
   # 进入后端目录
   cd Qingyu_backend
   
   # 启动服务
   go run cmd/server/main.go
   ```
   
   后端服务默认运行在：`http://localhost:8080`

2. **前端配置正确**
   - 确认 `Qingyu/src/utils/request.js` 中的 baseURL 配置正确
   - 默认配置：`http://localhost:8080/api/v1`

---

## 📖 使用教程

### 1. 用户认证测试

#### 1.1 测试用户注册

1. 切换到 **"用户认证"** 标签页
2. 在 "用户注册" 卡片中填写信息：
   - 用户名：`testuser`（3-50字符）
   - 邮箱：`test@example.com`
   - 密码：`password123`（最少6字符）
3. 点击 **"测试注册"** 按钮
4. 查看响应结果（包含token）

#### 1.2 测试用户登录

1. 在 "用户登录" 卡片中输入：
   - 用户名/邮箱：刚才注册的用户名或邮箱
   - 密码：注册时使用的密码
2. 点击 **"测试登录"** 按钮
3. 登录成功后，Token会自动保存，后续需要认证的接口将自动携带Token

**💡 提示**: 登录后页面会显示 "Token: 已设置"，此时可以测试需要认证的接口。

#### 1.3 测试获取个人信息

1. 确保已登录（Token已设置）
2. 点击 **"获取个人信息"** 按钮
3. 查看当前用户的详细信息

#### 1.4 测试更新个人信息

1. 在表单中输入要更新的信息：
   - 昵称
   - 个人简介
2. 点击 **"更新信息"** 按钮
3. 查看更新结果

---

### 2. 书城系统测试

#### 2.1 测试获取首页数据

1. 切换到 **"书城系统"** 标签页
2. 直接点击 **"获取首页数据"** 按钮
3. 查看返回的Banner、推荐书籍、分类等数据

#### 2.2 测试书籍列表

1. 设置查询参数：
   - 页码：1
   - 每页数量：20
   - 分类：`玄幻`（可选）
2. 点击 **"获取书籍列表"** 按钮
3. 查看分页后的书籍列表

#### 2.3 测试书籍搜索

1. 输入搜索关键词：如 `斗破`
2. 选择搜索类型：
   - `all`：全部
   - `title`：书名
   - `author`：作者
3. 点击 **"搜索书籍"** 按钮

#### 2.4 测试书籍详情

1. 输入书籍ID（从书籍列表中获取）
2. 点击 **"获取书籍详情"** 按钮
3. 查看书籍的详细信息

#### 2.5 测试章节列表

1. 输入书籍ID
2. 设置页码（默认1）
3. 点击 **"获取章节列表"** 按钮
4. 查看该书的章节列表

---

### 3. 阅读器测试

#### 3.1 测试章节内容（需要登录）

1. 切换到 **"阅读器"** 标签页
2. 确保已登录
3. 输入章节ID
4. 点击 **"获取章节内容"** 按钮
5. 查看章节正文内容

#### 3.2 测试章节导航

1. 输入书籍ID和当前章节号
2. 点击 **"获取章节导航"** 按钮
3. 查看上一章和下一章的信息

#### 3.3 测试阅读进度

**保存进度**：
1. 输入书籍ID、章节ID
2. 设置进度值（0.0-1.0，如0.5表示50%）
3. 点击 **"保存进度"** 按钮

**获取进度**：
1. 输入书籍ID
2. 点击 **"获取进度"** 按钮
3. 查看当前阅读进度

#### 3.4 测试阅读历史

1. 设置页码
2. 点击 **"获取阅读历史"** 按钮
3. 查看最近阅读的书籍列表

#### 3.5 测试阅读设置

**获取设置**：
- 直接点击 **"获取阅读设置"** 按钮

**更新设置**：
1. 修改字体大小（12-24）
2. 选择主题（默认/夜间/护眼）
3. 点击 **"更新设置"** 按钮

---

### 4. 注记功能测试

#### 4.1 测试创建注记

1. 切换到 **"注记功能"** 标签页
2. 输入必填信息：
   - 书籍ID
   - 章节ID
   - 选择类型：书签/高亮/笔记
   - 选中文本
   - 范围（如：100-150）
3. 如果是笔记类型，填写笔记内容
4. 点击 **"创建注记"** 按钮

#### 4.2 测试获取注记列表

1. 输入书籍ID
2. 选择类型筛选（可选）
3. 点击 **"获取注记列表"** 按钮

#### 4.3 测试注记统计

1. 直接点击 **"获取统计"** 按钮
2. 查看书签、高亮、笔记的数量统计

#### 4.4 测试删除注记

1. 输入注记ID（从注记列表中获取）
2. 点击 **"删除注记"** 按钮

---

### 5. 评分系统测试

#### 5.1 测试获取评分列表

1. 切换到 **"评分系统"** 标签页
2. 输入书籍ID
3. 设置页码
4. 点击 **"获取评分列表"** 按钮

#### 5.2 测试评分统计

1. 输入书籍ID
2. 点击 **"获取评分统计"** 按钮
3. 查看平均评分、总评分数、评分分布

#### 5.3 测试创建评分（需要登录）

1. 确保已登录
2. 输入书籍ID
3. 选择评分（1-5星）
4. 填写评价内容（可选）
5. 点击 **"提交评分"** 按钮

#### 5.4 测试更新评分

1. 输入评分ID（从评分列表中获取）
2. 修改评分或评价内容
3. 点击 **"更新评分"** 按钮

#### 5.5 测试删除评分

1. 输入评分ID
2. 点击 **"删除评分"** 按钮

---

## 🎯 测试场景示例

### 场景1：完整的用户注册和登录流程

```
1. 用户认证 -> 用户注册 -> 填写信息 -> 测试注册
2. 查看响应，记录用户名和邮箱
3. 用户认证 -> 用户登录 -> 输入凭证 -> 测试登录
4. 确认Token已设置
5. 用户认证 -> 获取个人信息 -> 验证信息正确
```

### 场景2：浏览和阅读书籍

```
1. 书城系统 -> 获取首页数据 -> 查看推荐书籍
2. 书城系统 -> 获取书籍列表 -> 记录某本书的ID
3. 书城系统 -> 获取书籍详情 -> 输入书ID -> 查看详情
4. 书城系统 -> 获取章节列表 -> 输入书ID -> 查看章节
5. 阅读器 -> 获取章节内容 -> 输入章节ID -> 阅读内容
```

### 场景3：阅读进度和注记管理

```
1. 先登录（参考场景1）
2. 阅读器 -> 保存阅读进度 -> 输入书ID、章节ID、进度
3. 注记功能 -> 创建注记 -> 添加书签或高亮
4. 注记功能 -> 获取注记列表 -> 查看所有注记
5. 阅读器 -> 获取阅读历史 -> 查看阅读记录
```

### 场景4：评分和评论

```
1. 确保已登录
2. 评分系统 -> 获取评分统计 -> 输入书ID -> 查看评分概况
3. 评分系统 -> 创建评分 -> 提交评分和评论
4. 评分系统 -> 获取评分列表 -> 查看所有评价
```

---

## 🔧 常见问题

### Q1: 请求失败，显示网络错误

**原因**：
- 后端服务未启动
- 端口配置不正确
- CORS配置问题

**解决方案**：
1. 检查后端服务是否运行：`http://localhost:8080`
2. 查看浏览器控制台的详细错误信息
3. 确认后端CORS配置允许前端域名

### Q2: Token未设置，无法测试需要认证的接口

**解决方案**：
1. 先完成用户登录
2. 确认登录响应中包含token
3. 刷新页面后需要重新登录

### Q3: 书籍ID或章节ID不知道填什么

**解决方案**：
1. 先测试"获取书籍列表"或"获取首页数据"
2. 从响应结果中复制书籍ID
3. 再测试"获取章节列表"获取章节ID

### Q4: 响应数据为空或没有数据

**原因**：
- 数据库中没有测试数据
- 查询参数不正确

**解决方案**：
1. 使用后端提供的数据初始化脚本
2. 检查查询参数是否正确
3. 查看后端日志了解详细信息

### Q5: 测试删除操作后无法恢复

**注意**：
- 删除操作会真实地修改数据库
- 建议使用测试数据库
- 或者创建专门的测试账号和测试数据

---

## 💡 最佳实践

### 1. 测试顺序建议

推荐按以下顺序进行测试：

```
1. 用户认证（注册 -> 登录）
2. 书城系统（首页 -> 列表 -> 详情）
3. 阅读器（章节 -> 进度 -> 设置）
4. 注记功能
5. 评分系统
```

### 2. 数据准备

- 准备多个测试账号（普通用户、作者、管理员）
- 准备测试书籍数据（不同分类、不同状态）
- 准备章节数据（测试VIP章节、免费章节）

### 3. 响应结果验证

对于每个API测试，应该检查：
- ✅ HTTP状态码是否正确（200, 201, 400, 401等）
- ✅ 响应code字段是否符合预期
- ✅ data字段中的数据结构是否完整
- ✅ 错误情况下的message是否有意义

### 4. 性能观察

- 注意响应时间
- 观察分页加载的性能
- 检查大数据量时的表现

---

## 📝 开发者提示

### 扩展测试工具

如需添加新的API测试：

1. **添加API接口**：
   ```javascript
   // Qingyu/src/api/your-module.js
   export const yourAPI = {
     yourMethod(params) {
       return request.get('/your-endpoint', { params })
     }
   }
   ```

2. **在测试页面添加测试卡片**：
   ```vue
   <!-- Qingyu/src/views/APITestView.vue -->
   <div class="test-card">
     <h3>测试你的API</h3>
     <button @click="testYourAPI">测试</button>
   </div>
   ```

3. **添加测试方法**：
   ```javascript
   const testYourAPI = () => handleRequest(
     () => yourAPI.yourMethod(params),
     () => yourData.value.result
   )
   ```

### 调试技巧

1. **查看请求详情**：
   - 打开浏览器开发者工具
   - 切换到Network标签
   - 观察请求/响应的详细信息

2. **使用控制台**：
   - 所有API响应都会打印到控制台
   - 使用`console.log`添加自定义调试信息

3. **修改测试数据**：
   - 测试页面的所有输入框都支持实时修改
   - 可以保存常用的测试数据以便复用

---

## 📞 技术支持

遇到问题？

1. 查看完整API文档：
   - [阅读端API使用文档](../Qingyu_backend/doc/api/阅读端API使用文档.md)
   - [用户管理API使用指南](../Qingyu_backend/doc/api/用户管理API使用指南.md)
   - [阅读端API快速开始指南](../Qingyu_backend/doc/api/阅读端API快速开始指南.md)

2. 检查后端日志：
   ```bash
   cd Qingyu_backend
   tail -f startup.log
   ```

3. 提交Issue到项目仓库

4. 联系开发团队

---

## 📋 更新日志

### v1.0 (2025-10-16)

- ✨ 初始版本发布
- ✅ 支持用户认证API测试
- ✅ 支持书城系统API测试
- ✅ 支持阅读器API测试
- ✅ 支持注记功能API测试
- ✅ 支持评分系统API测试
- ✅ 自动Token管理
- ✅ 实时响应预览

---

**文档版本**: v1.0  
**最后更新**: 2025-10-16  
**维护者**: 青羽前端团队


