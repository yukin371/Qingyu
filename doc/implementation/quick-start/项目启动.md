# 项目启动指南

## 1. 概述

本文档详细说明如何克隆青羽书城前端项目、安装依赖并启动开发服务器。

### 1.1 前置条件

在开始之前，请确保已完成[环境搭建](./环境搭建.md)，包括：

- ✅ Node.js 16+ 已安装
- ✅ npm/pnpm 已安装并配置
- ✅ Git 已安装并配置
- ✅ VS Code 及推荐插件已安装

## 2. 克隆项目

### 2.1 使用 HTTPS 克隆

```bash
# 克隆项目
git clone https://github.com/your-org/qingyu-frontend.git

# 进入项目目录
cd qingyu-frontend
```

### 2.2 使用 SSH 克隆（推荐）

```bash
# 克隆项目
git clone git@github.com:your-org/qingyu-frontend.git

# 进入项目目录
cd qingyu-frontend
```

### 2.3 克隆特定分支

```bash
# 克隆 develop 分支
git clone -b develop https://github.com/your-org/qingyu-frontend.git

# 或者先克隆再切换分支
git clone https://github.com/your-org/qingyu-frontend.git
cd qingyu-frontend
git checkout develop
```

## 3. 项目结构

克隆完成后，项目结构如下：

```
qingyu-frontend/
├── public/              # 静态资源
│   ├── favicon.ico
│   └── ...
├── src/                 # 源代码
│   ├── api/            # API接口
│   ├── assets/         # 资源文件
│   ├── components/     # 公共组件
│   ├── router/         # 路由配置
│   ├── stores/         # 状态管理
│   ├── utils/          # 工具函数
│   ├── views/          # 页面组件
│   ├── App.vue         # 根组件
│   └── main.js         # 入口文件
├── tests/              # 测试文件
├── .env.development    # 开发环境变量
├── .env.production     # 生产环境变量
├── .eslintrc.js        # ESLint配置
├── .prettierrc         # Prettier配置
├── index.html          # HTML模板
├── package.json        # 项目配置
├── vite.config.js      # Vite配置
└── README.md           # 项目说明
```

## 4. 安装依赖

### 4.1 使用 npm

```bash
# 安装依赖
npm install

# 或使用 npm ci（更适合CI环境）
npm ci
```

### 4.2 使用 pnpm（推荐）

```bash
# 安装依赖
pnpm install

# 或简写
pnpm i
```

### 4.3 依赖安装说明

**安装时间**：首次安装约需 2-5 分钟（取决于网络速度）

**安装内容**：
- Vue 3核心库
- Element Plus UI组件库
- Vue Router 路由库
- Pinia 状态管理库
- Axios HTTP客户端
- 开发工具和插件

**安装日志示例**：
```
Packages: +234
+++++++++++++++++++++++++++++++++++++++
Progress: resolved 234, reused 234, downloaded 0, added 234, done

dependencies:
+ vue 3.3.4
+ vue-router 4.2.4
+ pinia 2.1.6
+ element-plus 2.3.14
+ axios 1.5.0

devDependencies:
+ vite 4.4.9
+ @vitejs/plugin-vue 4.3.4
+ vitest 0.34.4

Done in 45.2s
```

## 5. 环境配置

### 5.1 环境变量文件

项目使用不同的环境变量文件：

**`.env.development`** (开发环境)
```bash
# API基础URL
VITE_API_BASE_URL=http://localhost:8080/api/v1

# 应用标题
VITE_APP_TITLE=青羽书城（开发环境）

# 是否启用Mock
VITE_USE_MOCK=false

# 调试模式
VITE_DEBUG=true
```

**`.env.production`** (生产环境)
```bash
# API基础URL
VITE_API_BASE_URL=https://api.qingyu.com/api/v1

# 应用标题
VITE_APP_TITLE=青羽书城

# 是否启用Mock
VITE_USE_MOCK=false

# 调试模式
VITE_DEBUG=false
```

### 5.2 自定义环境变量

如需自定义配置，创建 `.env.local` 文件：

```bash
# .env.local (不会被提交到Git)
VITE_API_BASE_URL=http://192.168.1.100:8080/api/v1
```

**优先级**：`.env.local` > `.env.development` > `.env`

### 5.3 环境变量使用

```javascript
// 在代码中使用
const apiBaseUrl = import.meta.env.VITE_API_BASE_URL
const appTitle = import.meta.env.VITE_APP_TITLE
const isDev = import.meta.env.DEV
const isProd = import.meta.env.PROD
```

## 6. 启动开发服务器

### 6.1 启动命令

```bash
# 使用 npm
npm run dev

# 使用 pnpm
pnpm dev
```

### 6.2 启动成功

成功启动后，会看到以下输出：

```
  VITE v4.4.9  ready in 423 ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://192.168.1.100:5173/
  ➜  press h to show help
```

### 6.3 访问应用

在浏览器中打开：
- **本地访问**：http://localhost:5173
- **局域网访问**：http://192.168.1.100:5173

### 6.4 指定端口

如果端口被占用，可以指定其他端口：

```bash
# package.json
{
  "scripts": {
    "dev": "vite --port 3000"
  }
}

# 或在命令行直接指定
npm run dev -- --port 3000
```

## 7. 其他常用命令

### 7.1 构建生产版本

```bash
# 构建
npm run build

# 构建输出在 dist/ 目录
```

### 7.2 预览生产构建

```bash
# 预览构建结果
npm run preview

# 访问 http://localhost:4173
```

### 7.3 代码检查

```bash
# ESLint 检查
npm run lint

# 自动修复
npm run lint:fix
```

### 7.4 代码格式化

```bash
# Prettier 格式化
npm run format

# 检查格式
npm run format:check
```

### 7.5 运行测试

```bash
# 运行单元测试
npm run test

# 运行测试并生成覆盖率
npm run test:coverage

# 监听模式
npm run test:watch
```

## 8. 开发工具配置

### 8.1 VS Code 配置

打开项目后，VS Code 会提示安装推荐的扩展：

```
This workspace has extension recommendations.
Would you like to install them?
```

点击 **Install All** 安装所有推荐扩展。

### 8.2 浏览器开发工具

1. **安装 Vue DevTools**
   - Chrome: [Vue.js devtools](https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd)
   - Firefox: [Vue.js devtools](https://addons.mozilla.org/en-US/firefox/addon/vue-js-devtools/)

2. **打开开发者工具**
   - Windows/Linux: `F12` 或 `Ctrl+Shift+I`
   - macOS: `Cmd+Option+I`

3. **查看 Vue 面板**
   - 在开发者工具中找到 "Vue" 标签页
   - 可以查看组件树、Pinia状态、路由信息等

## 9. 热更新和热重载

### 9.1 热模块替换（HMR）

Vite 默认启用HMR，修改代码后会自动更新页面，无需刷新。

**支持 HMR 的文件类型**：
- ✅ `.vue` 组件
- ✅ `.js` JavaScript模块
- ✅ `.css` 样式文件
- ✅ `.json` JSON文件

### 9.2 完全重载

某些情况下需要完全刷新：
- 修改环境变量
- 修改 `vite.config.js`
- 修改 `index.html`

**触发完全重载**：
```bash
# 按 r 键重载
# 或在浏览器中按 Ctrl+R / Cmd+R
```

## 10. 连接后端服务

### 10.1 启动后端服务

确保后端服务已启动：

```bash
# 进入后端项目目录
cd ../Qingyu_backend

# 启动后端服务（具体命令参考后端文档）
go run cmd/server/main.go
```

### 10.2 配置代理

如果后端在不同端口，在 `vite.config.js` 中配置代理：

```javascript
export default {
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  }
}
```

### 10.3 验证连接

```javascript
// 在浏览器控制台测试
fetch('/api/v1/health')
  .then(res => res.json())
  .then(data => console.log('后端连接成功:', data))
  .catch(err => console.error('后端连接失败:', err))
```

## 11. 常见问题

### 11.1 依赖安装失败

**问题**：`npm install` 失败

**解决方案**：
```bash
# 清除缓存
npm cache clean --force

# 删除 node_modules 和 lock 文件
rm -rf node_modules package-lock.json

# 重新安装
npm install
```

### 11.2 端口被占用

**问题**：`Port 5173 is in use`

**解决方案**：
```bash
# 方式1：指定其他端口
npm run dev -- --port 3000

# 方式2：查找并关闭占用端口的进程
# Windows
netstat -ano | findstr :5173
taskkill /PID <PID> /F

# macOS/Linux
lsof -ti:5173 | xargs kill
```

### 11.3 模块找不到

**问题**：`Cannot find module '@/components/...'`

**解决方案**：
```bash
# 确保路径别名配置正确
# vite.config.js
import path from 'path'

export default {
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  }
}

# 重启开发服务器
```

### 11.4 样式不生效

**问题**：CSS 样式没有应用

**解决方案**：
```vue
<!-- 检查 scoped 属性 -->
<style scoped>
/* 组件内样式 */
</style>

<style>
/* 全局样式 */
</style>

<!-- 使用深度选择器 -->
<style scoped>
:deep(.element-class) {
  /* 样式 */
}
</style>
```

### 11.5 环境变量不生效

**问题**：环境变量读取为 undefined

**解决方案**：
```bash
# 1. 确保变量名以 VITE_ 开头
VITE_API_URL=xxx  # ✅ 正确
API_URL=xxx       # ❌ 错误

# 2. 重启开发服务器
# 环境变量修改后需要重启

# 3. 检查是否正确导入
const url = import.meta.env.VITE_API_URL  # ✅ 正确
const url = process.env.VITE_API_URL      # ❌ 错误（这是Node.js语法）
```

## 12. 性能提示

### 12.1 首次启动优化

```bash
# 使用 pnpm（更快的安装速度）
pnpm install

# 预构建依赖
npm run build:deps
```

### 12.2 开发服务器优化

```javascript
// vite.config.js
export default {
  server: {
    // 预构建
    force: false,
    // 文件系统缓存
    fs: {
      strict: false
    }
  },
  optimizeDeps: {
    include: ['vue', 'vue-router', 'pinia', 'element-plus']
  }
}
```

## 13. 下一步

项目启动成功后，建议：

1. 阅读 [开发工作流](./开发工作流.md) 了解日常开发流程
2. 查看 [组件开发指南](../development/组件开发指南.md) 学习组件开发
3. 参考 [API集成指南](../development/API集成指南.md) 了解接口调用

## 14. 快速命令参考

```bash
# 克隆项目
git clone <repository-url>
cd qingyu-frontend

# 安装依赖
pnpm install

# 启动开发服务器
pnpm dev

# 构建生产版本
pnpm build

# 预览生产构建
pnpm preview

# 代码检查
pnpm lint

# 运行测试
pnpm test
```

---

**文档版本**：v1.0.0  
**创建时间**：2025年10月13日  
**最后更新**：2025年10月13日  
**维护者**：前端团队

