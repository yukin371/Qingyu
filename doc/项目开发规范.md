# 青羽书城前端开发规范

## 项目介绍

**项目名称**：青羽书城前端（Qingyu Frontend）

青羽书城前端是基于 Vue 3 生态系统构建的现代化书城展示平台，致力于为用户提供优雅、流畅的书籍浏览和阅读体验。项目采用组件化架构设计，确保代码的可维护性、可扩展性和高性能。

**技术栈**
- **前端框架**：Vue 3 + Composition API - 利用最新的响应式系统和组合式API提供更好的开发体验
- **UI组件库**：Element Plus - 基于Vue 3的企业级UI组件库，提供丰富的组件和主题定制
- **状态管理**：Pinia - Vue官方推荐的状态管理库，提供类型安全和开发工具支持
- **路由管理**：Vue Router 4 - 支持动态路由、路由守卫和懒加载的现代路由解决方案
- **HTTP客户端**：Axios - 基于Promise的HTTP库，支持请求/响应拦截器和自动转换
- **构建工具**：Vite - 快速的构建工具，提供热模块替换和优化的生产构建
- **开发语言**：JavaScript (ES6+) - 使用现代JavaScript特性提高开发效率
- **样式方案**：CSS3 + PostCSS - 支持现代CSS特性和自动前缀

## 项目架构设计原则

本项目采用现代化的前端架构模式，遵循组件化、模块化和可维护性原则。

### 架构层次
```
Pages (页面层) -> Components (组件层) -> Stores (状态层) -> API (接口层) -> Utils (工具层)
```

**设计原则**：
- **单一职责**：每个组件、模块只负责一个明确的功能
- **组件复用**：通过props和slots实现组件的高度复用
- **状态集中**：使用Pinia进行集中状态管理
- **接口统一**：统一的API调用和错误处理机制

---

## 目录结构规范

### 项目目录结构
```
src/
├── api/                    # API接口层
│   ├── bookstore.js       # 书城相关接口
│   ├── user.js            # 用户相关接口
│   └── index.js           # 接口统一导出
├── assets/                # 静态资源
│   ├── images/            # 图片资源
│   ├── icons/             # 图标资源
│   └── styles/            # 全局样式
├── components/            # 公共组件
│   ├── common/            # 通用组件
│   ├── business/          # 业务组件
│   └── layout/            # 布局组件
├── composables/           # 组合式函数
│   ├── useApi.js          # API调用hooks
│   ├── useAuth.js         # 认证相关hooks
│   └── useUtils.js        # 工具函数hooks
├── router/                # 路由配置
│   ├── index.js           # 主路由文件
│   └── guards.js          # 路由守卫
├── stores/                # 状态管理
│   ├── modules/           # 状态模块
│   └── index.js           # store入口
├── utils/                 # 工具函数
│   ├── request.js         # 请求工具
│   ├── storage.js         # 存储工具
│   └── helpers.js         # 辅助函数
├── views/                 # 页面组件
│   ├── home/              # 首页相关
│   ├── books/             # 书籍相关
│   └── rankings/          # 榜单相关
├── App.vue                # 根组件
└── main.js                # 入口文件
```

### 文件命名规范

**组件文件**：使用 PascalCase
```javascript
// ✅ 正确
BannerCarousel.vue
BookGrid.vue
RankingList.vue

// ❌ 错误
bannerCarousel.vue
book-grid.vue
ranking_list.vue
```

**工具文件**：使用 camelCase
```javascript
// ✅ 正确
apiRequest.js
userHelpers.js
dateUtils.js

// ❌ 错误
ApiRequest.js
user-helpers.js
date_utils.js
```

**页面文件**：使用 PascalCase + View 后缀
```javascript
// ✅ 正确
HomeView.vue
BookDetailView.vue
RankingsView.vue

// ❌ 错误
home.vue
bookDetail.vue
Rankings.vue
```

---

## 组件开发规范

### 1. 组件结构

**标准组件结构**：
```vue
<template>
  <!-- 模板内容 -->
</template>

<script>
import { ref, computed, onMounted } from 'vue'
import { useStore } from '@/stores'

export default {
  name: 'ComponentName',
  props: {
    // props定义
  },
  emits: ['event-name'],
  setup(props, { emit }) {
    // 组合式API逻辑
    return {
      // 返回响应式数据和方法
    }
  }
}
</script>

<style scoped>
/* 组件样式 */
</style>
```

### 2. Props 定义规范

**Props 必须包含类型和默认值**：
```javascript
props: {
  title: {
    type: String,
    required: true
  },
  items: {
    type: Array,
    default: () => []
  },
  loading: {
    type: Boolean,
    default: false
  },
  maxItems: {
    type: Number,
    default: 10,
    validator: (value) => value > 0
  }
}
```

### 3. 事件命名规范

**使用 kebab-case 命名事件**：
```javascript
// ✅ 正确
emit('item-click', item)
emit('view-more')
emit('data-loaded')

// ❌ 错误
emit('itemClick', item)
emit('viewMore')
emit('dataLoaded')
```

### 4. 组件通信规范

**父子组件通信**：
- 父传子：使用 props
- 子传父：使用 emit
- 跨组件：使用 Pinia store

**示例**：
```vue
<!-- 父组件 -->
<template>
  <BookGrid 
    :books="books"
    :loading="loading"
    @book-click="handleBookClick"
    @view-more="handleViewMore"
  />
</template>

<!-- 子组件 -->
<script>
export default {
  emits: ['book-click', 'view-more'],
  setup(props, { emit }) {
    const handleBookClick = (book) => {
      emit('book-click', book)
    }
    
    return { handleBookClick }
  }
}
</script>
```

---

## 状态管理规范

### 1. Store 结构

**使用 Pinia 进行状态管理**：
```javascript
// stores/bookstore.js
import { defineStore } from 'pinia'
import { bookstoreAPI } from '@/api/bookstore'

export const useBookstoreStore = defineStore('bookstore', {
  state: () => ({
    // 状态定义
    homepageData: null,
    loading: false,
    error: null
  }),

  getters: {
    // 计算属性
    getHomepageBanners: (state) => {
      return state.homepageData?.banners || []
    }
  },

  actions: {
    // 异步操作
    async fetchHomepageData() {
      this.loading = true
      try {
        const response = await bookstoreAPI.getHomepage()
        this.homepageData = response.data
      } catch (error) {
        this.error = error.message
      } finally {
        this.loading = false
      }
    }
  }
})
```

### 2. 状态命名规范

**状态字段命名**：
- 数据：使用名词，如 `books`、`userData`
- 状态：使用形容词，如 `loading`、`error`
- 标志：使用 `is` 前缀，如 `isLoggedIn`

### 3. Action 规范

**异步操作必须包含错误处理**：
```javascript
actions: {
  async fetchData() {
    this.loading = true
    this.error = null
    
    try {
      const response = await api.getData()
      this.data = response.data
    } catch (error) {
      this.error = error.message
      console.error('获取数据失败:', error)
    } finally {
      this.loading = false
    }
  }
}
```

---

## API 集成规范

### 1. API 文件结构

**统一的 API 接口封装**：
```javascript
// api/bookstore.js
import axios from 'axios'

const api = axios.create({
  baseURL: 'http://localhost:8080/api/v1',
  timeout: 10000
})

// 请求拦截器
api.interceptors.request.use(
  config => {
    // 添加认证token等
    return config
  },
  error => Promise.reject(error)
)

// 响应拦截器
api.interceptors.response.use(
  response => response.data,
  error => {
    console.error('API请求错误:', error)
    return Promise.reject(error)
  }
)

export const bookstoreAPI = {
  getHomepage() {
    return api.get('/bookstore/homepage')
  },
  
  getRealtimeRanking(limit = 20) {
    return api.get('/bookstore/rankings/realtime', {
      params: { limit }
    })
  }
}
```

### 2. 错误处理规范

**统一的错误处理机制**：
```javascript
// 在组件中使用
async loadData() {
  try {
    await this.store.fetchHomepageData()
  } catch (error) {
    // 使用 Element Plus 的消息提示
    ElMessage.error('加载数据失败: ' + error.message)
  }
}
```

---

## 样式开发规范

### 1. CSS 命名规范

**使用 BEM 命名方法**：
```css
/* 块 */
.book-card { }

/* 元素 */
.book-card__title { }
.book-card__author { }
.book-card__cover { }

/* 修饰符 */
.book-card--featured { }
.book-card--loading { }
```

### 2. 样式组织

**组件样式使用 scoped**：
```vue
<style scoped>
.component-name {
  /* 组件根样式 */
}

.component-name__element {
  /* 元素样式 */
}

/* 响应式设计 */
@media (max-width: 768px) {
  .component-name {
    /* 移动端样式 */
  }
}

/* 深色模式适配 */
@media (prefers-color-scheme: dark) {
  .component-name {
    /* 深色模式样式 */
  }
}
</style>
```

### 3. CSS 变量使用

**定义全局CSS变量**：
```css
/* assets/styles/variables.css */
:root {
  --primary-color: #409eff;
  --success-color: #67c23a;
  --warning-color: #e6a23c;
  --danger-color: #f56c6c;
  
  --font-size-small: 12px;
  --font-size-base: 14px;
  --font-size-large: 16px;
  
  --border-radius: 4px;
  --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}
```

---

## 代码质量规范

### 1. ESLint 配置

**使用 ESLint 进行代码检查**：
```javascript
// eslint.config.js
export default [
  {
    rules: {
      'vue/multi-word-component-names': 'error',
      'vue/no-unused-vars': 'error',
      'no-console': 'warn',
      'no-debugger': 'error'
    }
  }
]
```

### 2. 代码注释规范

**组件注释**：
```javascript
/**
 * 书籍网格展示组件
 * @description 用于展示书籍列表的网格布局组件
 * @author 开发者姓名
 * @date 2024-01-01
 */
export default {
  name: 'BookGrid',
  // ...
}
```

**方法注释**：
```javascript
/**
 * 处理书籍点击事件
 * @param {Object} book - 书籍对象
 * @param {string} book.id - 书籍ID
 * @param {string} book.title - 书籍标题
 */
const handleBookClick = (book) => {
  // 实现逻辑
}
```

### 3. 性能优化规范

**组件懒加载**：
```javascript
// 路由懒加载
const routes = [
  {
    path: '/books',
    component: () => import('@/views/BooksView.vue')
  }
]
```

**图片懒加载**：
```vue
<template>
  <img 
    :src="book.cover" 
    :alt="book.title"
    loading="lazy"
    @error="handleImageError"
  />
</template>
```

---

## 测试规范

### 1. 单元测试

**使用 Vitest 进行单元测试**：
```javascript
// tests/components/BookGrid.test.js
import { mount } from '@vue/test-utils'
import { describe, it, expect } from 'vitest'
import BookGrid from '@/components/BookGrid.vue'

describe('BookGrid', () => {
  it('renders books correctly', () => {
    const books = [
      { id: '1', title: 'Test Book', author: 'Test Author' }
    ]
    
    const wrapper = mount(BookGrid, {
      props: { books }
    })
    
    expect(wrapper.text()).toContain('Test Book')
  })
})
```

### 2. 端到端测试

**使用 Cypress 进行 E2E 测试**：
```javascript
// cypress/e2e/homepage.cy.js
describe('Homepage', () => {
  it('displays homepage content', () => {
    cy.visit('/')
    cy.contains('青羽书城')
    cy.get('[data-testid="banner-carousel"]').should('be.visible')
  })
})
```

---

## 部署规范

### 1. 环境配置

**环境变量管理**：
```javascript
// .env.development
VITE_API_BASE_URL=http://localhost:8080/api/v1
VITE_APP_TITLE=青羽书城（开发环境）

// .env.production
VITE_API_BASE_URL=https://api.qingyu.com/api/v1
VITE_APP_TITLE=青羽书城
```

### 2. 构建优化

**Vite 构建配置**：
```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router', 'pinia'],
          elementPlus: ['element-plus']
        }
      }
    }
  }
}
```

---

## 开发流程规范

### 1. Git 工作流

**分支命名规范**：
- `feature/功能名称` - 新功能开发
- `bugfix/问题描述` - 问题修复
- `hotfix/紧急修复` - 紧急修复
- `refactor/重构内容` - 代码重构

**提交信息规范**：
```
type(scope): description

feat(components): 添加书籍网格组件
fix(api): 修复接口请求超时问题
docs(readme): 更新项目文档
style(css): 优化响应式布局
refactor(store): 重构状态管理结构
test(unit): 添加组件单元测试
```

### 2. 代码审查

**Pull Request 规范**：
1. 提供清晰的PR描述
2. 包含相关的测试用例
3. 确保所有检查通过
4. 至少一人审查后合并

---

## 最佳实践

### 1. 性能优化
- 使用 `v-memo` 优化列表渲染
- 合理使用 `computed` 和 `watch`
- 避免在模板中使用复杂表达式
- 使用 `shallowRef` 和 `shallowReactive` 优化大对象

### 2. 用户体验
- 提供加载状态指示
- 实现错误边界处理
- 支持键盘导航
- 适配移动端和深色模式

### 3. 可维护性
- 保持组件单一职责
- 使用 TypeScript 提高类型安全
- 编写完善的文档和注释
- 定期重构和优化代码

---

**文档版本**：v1.0.0  
**最后更新**：2024年1月  
**维护者**：前端开发团队