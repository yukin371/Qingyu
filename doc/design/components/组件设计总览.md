# 青羽书城组件设计总览

## 1. 组件体系概述

青羽书城前端采用组件化架构，将UI拆分为可复用、可组合的组件单元。组件体系遵循原子设计理论，从基础原子组件到复杂的页面模板，形成完整的组件生态。

### 1.1 设计原则

- **单一职责**：每个组件只负责一个明确的功能
- **高内聚低耦合**：组件内部逻辑紧密，组件间依赖最小
- **可复用性**：通过props和slots实现灵活的组件复用
- **一致性**：统一的设计语言和交互模式
- **可访问性**：支持键盘导航和屏幕阅读器

### 1.2 组件分层

```
页面模板 (Templates)
    ↓
页面组件 (Pages)
    ↓
业务组件 (Organisms)
    ↓
功能组件 (Molecules)
    ↓
基础组件 (Atoms)
```

## 2. 组件分类

### 2.1 基础组件 (Atoms)

基础组件是最小的UI单元，不包含业务逻辑，高度可复用。

#### 2.1.1 按钮组件 (BaseButton)

```vue
<BaseButton 
  type="primary" 
  size="medium" 
  :loading="false"
  :disabled="false"
  @click="handleClick"
>
  点击按钮
</BaseButton>
```

**特性**：

- 支持多种类型：primary、success、warning、danger、info、text
- 支持多种尺寸：large、medium、small、mini
- 支持加载状态和禁用状态
- 支持图标和文字组合

#### 2.1.2 输入框组件 (BaseInput)

```vue
<BaseInput 
  v-model="value"
  type="text"
  placeholder="请输入内容"
  :clearable="true"
  :show-password="false"
  @input="handleInput"
  @focus="handleFocus"
  @blur="handleBlur"
/>
```

**特性**：

- 支持多种输入类型
- 支持清空和密码显示功能
- 支持前缀和后缀插槽
- 内置表单验证支持

#### 2.1.3 图标组件 (BaseIcon)

```vue
<BaseIcon 
  name="search" 
  size="16" 
  color="#409eff"
  :spin="false"
/>
```

**特性**：

- 基于Element Plus图标库
- 支持自定义尺寸和颜色
- 支持旋转动画
- SVG图标优化

### 2.2 功能组件 (Molecules)

功能组件由多个基础组件组合而成，实现特定的交互功能。

#### 2.2.1 搜索框组件 (SearchBox)

```vue
<SearchBox 
  v-model="keyword"
  placeholder="搜索书籍..."
  :suggestions="suggestions"
  :loading="loading"
  @search="handleSearch"
  @suggestion-click="handleSuggestionClick"
/>
```

**组成**：

- BaseInput（输入框）
- BaseButton（搜索按钮）
- BaseIcon（搜索图标）
- 下拉建议列表

#### 2.2.2 分页组件 (Pagination)

```vue
<Pagination 
  :current-page="currentPage"
  :page-size="pageSize"
  :total="total"
  :page-sizes="[10, 20, 50, 100]"
  @current-change="handlePageChange"
  @size-change="handleSizeChange"
/>
```

**组成**：

- 页码按钮
- 上一页/下一页按钮
- 页面大小选择器
- 总数显示

#### 2.2.3 加载组件 (LoadingSpinner)

```vue
<LoadingSpinner 
  :loading="loading"
  text="加载中..."
  size="medium"
  overlay
/>
```

**特性**：

- 多种加载动画样式
- 支持遮罩层
- 自定义加载文本
- 响应式尺寸

### 2.3 业务组件 (Organisms)

业务组件包含特定的业务逻辑，是页面的主要构成部分。

#### 2.3.1 Banner轮播组件 (BannerCarousel)

**文件位置**：`src/components/BannerCarousel.vue`

```vue
<BannerCarousel 
  :banners="banners"
  height="400px"
  :interval="4000"
  :show-indicators="true"
  :show-arrows="true"
  @banner-click="handleBannerClick"
/>
```

**功能特性**：

- 自动轮播和手动切换
- 支持多种跳转类型（书籍、分类、外链）
- 响应式设计
- 点击统计
- 图片懒加载和错误处理

**数据结构**：

```javascript
const banner = {
  id: 'banner_001',
  title: 'Banner标题',
  description: 'Banner描述',
  image: 'https://example.com/banner.jpg',
  target: 'book_id_123',
  targetType: 'book', // book | category | url
  sortOrder: 1,
  isActive: true
}
```

#### 2.3.2 榜单展示组件 (RankingList)

**文件位置**：`src/components/RankingList.vue`

```vue
<RankingList 
  type="realtime"
  :items="rankingItems"
  :loading="loading"
  :max-items="10"
  @view-more="handleViewMore"
  @item-click="handleItemClick"
/>
```

**功能特性**：

- 支持四种榜单类型（实时榜、周榜、月榜、新人榜）
- 排名徽章样式（金银铜）
- 书籍信息展示
- 统计数据格式化
- 空状态处理

**榜单类型**：

- `realtime` - 实时榜
- `weekly` - 周榜
- `monthly` - 月榜
- `newbie` - 新人榜

#### 2.3.3 书籍网格组件 (BookGrid)

**文件位置**：`src/components/BookGrid.vue`

```vue
<BookGrid 
  title="推荐书籍"
  :books="books"
  :loading="loading"
  :max-items="8"
  :columns="4"
  @view-more="handleViewMore"
  @book-click="handleBookClick"
/>
```

**功能特性**：

- 响应式网格布局
- 书籍卡片悬停效果
- 评分和标签展示
- 图片懒加载
- 无限滚动支持

**书籍数据结构**：

```javascript
const book = {
  id: 'book_001',
  title: '书籍标题',
  author: '作者姓名',
  cover: 'https://example.com/cover.jpg',
  rating: 4.5,
  ratingCount: 1234,
  viewCount: 5678,
  likeCount: 890,
  tags: ['玄幻', '热血'],
  introduction: '书籍简介...'
}
```

#### 2.3.4 书籍卡片组件 (BookCard)

```vue
<BookCard 
  :book="book"
  size="medium"
  :show-stats="true"
  :show-tags="true"
  @click="handleClick"
  @like="handleLike"
/>
```

**功能特性**：

- 多种尺寸规格
- 书籍信息展示
- 交互操作（点击、收藏）
- 状态指示（新书、完结）

### 2.4 布局组件 (Layout)

#### 2.4.1 应用头部 (AppHeader)

```vue
<AppHeader 
  :user="currentUser"
  :show-search="true"
  @search="handleSearch"
  @user-menu="handleUserMenu"
/>
```

**功能特性**：

- Logo和导航菜单
- 搜索框集成
- 用户菜单
- 响应式折叠

#### 2.4.2 应用容器 (AppContainer)

```vue
<AppContainer 
  :max-width="1200"
  :padding="20"
  center
>
  <slot />
</AppContainer>
```

**功能特性**：

- 响应式容器
- 最大宽度限制
- 内边距控制
- 居中对齐

## 3. 组件设计规范

### 3.1 Props 设计规范

#### 3.1.1 Props 命名

- 使用 camelCase 命名
- 布尔类型使用 `is`、`has`、`show` 前缀
- 事件回调使用 `on` 前缀

```javascript
props: {
  // ✅ 正确
  maxItems: Number,
  showMore: Boolean,
  isLoading: Boolean,
  onItemClick: Function,
  
  // ❌ 错误
  max_items: Number,
  showmore: Boolean,
  loading: Boolean,
  itemClick: Function
}
```

#### 3.1.2 Props 类型定义

```javascript
props: {
  title: {
    type: String,
    required: true,
    validator: (value) => value.length > 0
  },
  items: {
    type: Array,
    default: () => [],
    validator: (value) => Array.isArray(value)
  },
  size: {
    type: String,
    default: 'medium',
    validator: (value) => ['small', 'medium', 'large'].includes(value)
  }
}
```

### 3.2 事件设计规范

#### 3.2.1 事件命名

- 使用 kebab-case 命名
- 使用动词描述事件行为
- 避免与原生事件冲突

```javascript
// ✅ 正确
emits: ['item-click', 'view-more', 'data-loaded']

// ❌ 错误  
emits: ['itemClick', 'click', 'load']
```

#### 3.2.2 事件参数

```javascript
// 单个参数
emit('item-click', item)

// 多个参数使用对象
emit('selection-change', {
  selected: selectedItems,
  total: totalItems,
  action: 'select-all'
})
```

### 3.3 插槽设计规范

#### 3.3.1 具名插槽

```vue
<template>
  <div class="card">
    <header class="card-header">
      <slot name="header" />
    </header>
  
    <main class="card-body">
      <slot />
    </main>
  
    <footer class="card-footer">
      <slot name="footer" />
    </footer>
  </div>
</template>
```

#### 3.3.2 作用域插槽

```vue
<template>
  <div class="list">
    <div 
      v-for="item in items" 
      :key="item.id"
      class="list-item"
    >
      <slot 
        :item="item" 
        :index="index"
        :selected="isSelected(item)"
      />
    </div>
  </div>
</template>
```

### 3.4 样式设计规范

#### 3.4.1 CSS 类命名

```css
/* 组件根类 */
.book-card { }

/* 元素类 */
.book-card__title { }
.book-card__author { }
.book-card__cover { }

/* 修饰符类 */
.book-card--featured { }
.book-card--loading { }

/* 状态类 */
.book-card.is-selected { }
.book-card.is-disabled { }
```

#### 3.4.2 CSS 变量使用

```css
.book-card {
  --card-padding: 16px;
  --card-border-radius: 8px;
  --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  
  padding: var(--card-padding);
  border-radius: var(--card-border-radius);
  box-shadow: var(--card-shadow);
}
```

## 4. 组件状态管理

### 4.1 本地状态

```vue
<script>
export default {
  setup() {
    // 响应式数据
    const loading = ref(false)
    const error = ref(null)
    const data = ref([])
  
    // 计算属性
    const hasData = computed(() => data.value.length > 0)
  
    // 方法
    const fetchData = async () => {
      loading.value = true
      try {
        const response = await api.getData()
        data.value = response.data
      } catch (err) {
        error.value = err.message
      } finally {
        loading.value = false
      }
    }
  
    return {
      loading,
      error,
      data,
      hasData,
      fetchData
    }
  }
}
</script>
```

### 4.2 全局状态

```javascript
// 使用 Pinia store
export default {
  setup() {
    const bookstoreStore = useBookstoreStore()
    const { books, loading } = storeToRefs(bookstoreStore)
  
    const loadBooks = () => {
      bookstoreStore.fetchBooks()
    }
  
    return {
      books,
      loading,
      loadBooks
    }
  }
}
```

## 5. 组件测试策略

### 5.1 单元测试

```javascript
// BookCard.test.js
import { mount } from '@vue/test-utils'
import BookCard from '@/components/BookCard.vue'

describe('BookCard', () => {
  const mockBook = {
    id: '1',
    title: 'Test Book',
    author: 'Test Author',
    cover: 'test-cover.jpg'
  }
  
  it('renders book information correctly', () => {
    const wrapper = mount(BookCard, {
      props: { book: mockBook }
    })
  
    expect(wrapper.text()).toContain('Test Book')
    expect(wrapper.text()).toContain('Test Author')
  })
  
  it('emits click event when clicked', async () => {
    const wrapper = mount(BookCard, {
      props: { book: mockBook }
    })
  
    await wrapper.trigger('click')
  
    expect(wrapper.emitted('click')).toBeTruthy()
    expect(wrapper.emitted('click')[0]).toEqual([mockBook])
  })
})
```

### 5.2 集成测试

```javascript
// BookGrid.integration.test.js
describe('BookGrid Integration', () => {
  it('displays books and handles interactions', async () => {
    const wrapper = mount(BookGrid, {
      props: {
        books: mockBooks,
        loading: false
      }
    })
  
    // 验证书籍渲染
    expect(wrapper.findAll('.book-card')).toHaveLength(mockBooks.length)
  
    // 测试点击事件
    await wrapper.find('.book-card').trigger('click')
    expect(wrapper.emitted('book-click')).toBeTruthy()
  })
})
```

## 6. 组件文档规范

### 6.1 组件文档模板

```markdown
# ComponentName

## 概述
组件的简要描述和用途。

## 基本用法
\`\`\`vue
<ComponentName 
  :prop1="value1"
  :prop2="value2"
  @event1="handler1"
/>
\`\`\`

## API

### Props
| 参数 | 说明 | 类型 | 可选值 | 默认值 |
|------|------|------|--------|--------|
| prop1 | 属性说明 | String | - | - |

### Events
| 事件名 | 说明 | 参数 |
|--------|------|------|
| event1 | 事件说明 | (value: any) |

### Slots
| 名称 | 说明 | 参数 |
|------|------|------|
| default | 默认插槽 | - |

## 示例
详细的使用示例和代码演示。
```

## 7. 组件开发工作流

### 7.1 开发流程

1. **需求分析** - 明确组件功能和使用场景
2. **设计评审** - 确定API设计和交互规范
3. **编码实现** - 按照规范实现组件功能
4. **单元测试** - 编写完整的测试用例
5. **文档编写** - 完善组件使用文档
6. **代码审查** - 团队成员审查代码质量
7. **集成测试** - 在实际场景中测试组件
8. **发布部署** - 发布到组件库

### 7.2 质量检查清单

- [ ] 组件功能完整实现
- [ ] Props 和 Events 设计合理
- [ ] 样式符合设计规范
- [ ] 响应式适配完成
- [ ] 无障碍访问支持
- [ ] 单元测试覆盖率 > 80%
- [ ] 组件文档完整
- [ ] 代码审查通过
- [ ] 性能测试通过

## 8. 组件库管理

### 8.1 版本管理

- 遵循语义化版本规范
- 主版本号：不兼容的API修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

### 8.2 发布流程

```bash
# 1. 更新版本号
npm version patch|minor|major

# 2. 构建组件库
npm run build:lib

# 3. 发布到npm
npm publish

# 4. 更新文档
npm run docs:build
npm run docs:deploy
```

## 9. 最佳实践

### 9.1 性能优化

- 使用 `v-memo` 优化列表渲染
- 合理使用 `computed` 缓存计算结果
- 避免在模板中使用复杂表达式
- 使用 `shallowRef` 优化大对象

### 9.2 用户体验

- 提供加载状态反馈
- 实现错误边界处理
- 支持键盘导航
- 适配移动端触摸操作

### 9.3 可维护性

- 保持组件职责单一
- 使用 TypeScript 提高类型安全
- 编写清晰的注释和文档
- 定期重构和优化代码

---

**文档版本**：v1.0.
**最后更新**：2025年9月
